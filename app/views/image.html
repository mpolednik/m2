{% from "_formhelpers.html" import render_field, render_submit %}
{% from "_comments.html" import list_comments %}
{% from "_voting.html" import votingmenu %}
{% extends "layout.html" %}


{% set actionbar=True %}
{% block actionbar %}
    {% if DEF_user %}
        <li class="centered">{{ votingmenu(DEF_user, image, "/ajax/vote_image") }}</li>
    {% endif %}
    {% if DEF_user and (DEF_user == image.owner or 'admin' in session) %}
        <li><a href="{{ url_for('image_edit', id=image.id) }}">{{ local.actions['EDIT'] }}</a><br></li>
        <li><a href="{{ url_for('image_delete', id=image.id) }}">{{ local.actions['DELETE'] }}</a><br></li>
    {% endif %}
    <li><a href="{{ url_for('category_one', name=image.category.name, page=request.args.get('page')) }}">{{ local.BACK }}</a></li>
{% endblock %}


{% set widget=True %}
{% block widget %}
    <ul>
        <li><h1>{{ local.image['INFO'] }}</h1></li>
        <li>Vlasník:&nbsp;<a href="/u/{{ image.owner.id }}">{{ image.owner.name }}</a></li>
        <li>Kategorie:&nbsp;<a href="/c/{{ image.category.name }}">{{ image.category.name }}</a></li>
        <li>Hodnocení:&nbsp;{{ image.rating }}</li>
        {% if image.exif %}
        <li><h1>{{ local.image['EXIF'] }}</h1></li>
            <ul>
            {% for exif in image.exif %}
                <li><strong>{{ exif.key }}</strong>: {{ exif.value }}</li>
            {% endfor %}
            </ul>
        {% endif %}
    </ul>
{% endblock %}


{% block body %}
    <img src="/static/img/upload/{{ image.filename }}" alt="">
    {% if DEF_user and not commented %}
        <form action="{{ url_for(('comment_submit'), id=image.id) }}" method="POST">
            <ul>
            {{ render_field(form.text) }}
            {{ form.hidden_tag() }}
            {{ render_submit(local.image['COMMENT']) }}
        </ul>
        </form>
    {% endif %}

<div class="comments-area" id="comments">

    <h3>{{ local.image['COMMENTS'] }}</h3>
    {{ list_comments(comments, DEF_user, image, local, session) }}
</div>
{% endblock %}


{% block js %}
    <script src="/static/js/ajaxfunctions.js"></script>
{% endblock %}
